---
title: "Exploring EIA 860"
author: "Matthew Butner"
date: "July 4, 2017"
output: 
  html_document: 
    theme: journal
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("D:/elec_data/eia_860/eia8602014")
library(readxl)
library(leaflet)
library(plyr)
library(knitr)
```

## EIA 860

EIA has some great data at an aggregate level. EIA 860 provides annual data on plant characteristics including capacity, location, ownership, and technology. Here I showcase some of the data for the year 2014. The data can be found at the following [eia webpage](https://www.eia.gov/electricity/data/eia860/xls/eia8602014.zip). The file names are preserved in the R code below. 

I first load the plant file, this has information on ownership and plant location. To get some more detailed information on the generating units at each plant, I load the generators file. This lists the capacity and fuel source. 

```{r, error=FALSE, echo=TRUE, warning=FALSE}
Plants  <- read_excel("2___Plant_Y2014.xlsx", skip = 1)
Generators <-  read_excel("3_1_Generator_Y2014.xlsx",skip=1)
df <- merge(Plants, Generators, all=TRUE)
```


# combing the data 

Because each unit and plant have ids, I can merge the two data sets. But first, I will summarize some of the important information on the generating units, at the plant level. 

```{r error=FALSE, warning=FALSE}

Gen.ddply <- ddply(.data=Generators,.(`Plant Code`), summarise, 
                   Prime_move=paste(unique(`Prime Mover`),collapse=","), 
                   Owner=paste(unique(`Ownership`) ,collapse=","),
                   Eng_sour=paste(unique(`Energy Source 1`) ,collapse=","), 
                   Strt_up_sour=paste(unique(`Startup Source 1`) ,collapse=","), 
                   Capac = sum(`Nameplate Capacity (MW)`),
                   pwr_fctr = mean(`Nameplate Power Factor`))

df <- merge(Plants, Gen.ddply, all=TRUE)
```

# visualizing the data
Using the latitudes from the plants files, and the capacity data from the generator files, we can plot the plants on a US map. 

```{r, error=FALSE, warning=FALSE}
pal <- colorFactor(rainbow(length(unique(df$`Eng_sour`))), 
                   domain = unique(df$`Eng_sour`))

map <- leaflet(df, options = leafletOptions(minZoom = 0, maxZoom = 18)) %>% 
  addTiles() %>%   
  addCircleMarkers(
    ~Longitude, ~Latitude, 
    color = ~pal(Eng_sour),
    radius = ~cut(df$`Capac`,5, labels=FALSE)+1,
    stroke = FALSE, fillOpacity = 0.5,
    popup = ~df$Eng_sour
    )  
setView(map, lng=-86, lat=40.3, zoom=5)
```

